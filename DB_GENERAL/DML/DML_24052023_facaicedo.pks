/*
  * Se ingresa los service port al parametro para los servicios safecity.
  *
  * @author Felix Caicedo <facaicedo@telconet.ec>
  * @version 1.0 24-05-2023
*/
DECLARE
    --
    Lv_User             VARCHAR2(60) := 'facaicedo';
    Lv_Ip               VARCHAR2(60) := '127.0.0.1';
    type                typeArray IS VARRAY(64) OF VARCHAR2(100);
    Lr_ListSpid2     	typeArray;
    Lr_ListSpid3        typeArray;
    Lr_ListSpid4        typeArray;
    Ln_Total            NUMBER;
    Ln_IdDetallePar     NUMBER;
    Lv_Spid             VARCHAR2(60);
    --
    Lv_NombreParametro  VARCHAR2(100) := 'PARAMETROS_MIGRACION_ALTA_DENSIDAD';
    Lv_DescParametro    VARCHAR2(60)  := 'SPID-ZTE';
    Lv_Estado           VARCHAR2(60)  := 'Activo';
    --
    CURSOR C_GetIdDetParametro (Cv_IndiceCliente VARCHAR2)
    IS
        SELECT DET.ID_PARAMETRO_DET, DET.VALOR2
        FROM DB_GENERAL.ADMI_PARAMETRO_CAB CAB
        INNER JOIN DB_GENERAL.ADMI_PARAMETRO_DET DET ON DET.PARAMETRO_ID = CAB.ID_PARAMETRO
        WHERE CAB.NOMBRE_PARAMETRO = Lv_NombreParametro
        AND DET.DESCRIPCION = Lv_DescParametro
        AND DET.VALOR1 = Cv_IndiceCliente
        AND DET.ESTADO = Lv_Estado;
    --
BEGIN
    --
    Lr_ListSpid2 := typeArray('402719232','402784768','402850304','402915840','402981376','403046912','403112448','403177984','403243520','403309056','403374592','403440128','403505664','403571200','403636736','403702272','403767808','403833344','403898880','403964416','404029952','404095488','404161024','404226560','404292096','404357632','404423168','404488704','404554240','404619776','404685312','404750848','404816384','404881920','404947456','405012992','405078528','405144064','405209600','405275136','405340672','405406208','405471744','405537280','405602816','405668352','405733888','405799424','405864960','405930496','405996032','406061568','406127104','406192640','406258176','406323712','406389248','406454784','406520320','406585856','406651392','406716928','406782464','406848000');
    Lr_ListSpid3 := typeArray('402719488','402785024','402850560','402916096','402981632','403047168','403112704','403178240','403243776','403309312','403374848','403440384','403505920','403571456','403636992','403702528','403768064','403833600','403899136','403964672','404030208','404095744','404161280','404226816','404292352','404357888','404423424','404488960','404554496','404620032','404685568','404751104','404816640','404882176','404947712','405013248','405078784','405144320','405209856','405275392','405340928','405406464','405472000','405537536','405603072','405668608','405734144','405799680','405865216','405930752','405996288','406061824','406127360','406192896','406258432','406323968','406389504','406455040','406520576','406586112','406651648','406717184','406782720','406848256');
    Lr_ListSpid4 := typeArray('402719744','402785280','402850816','402916352','402981888','403047424','403112960','403178496','403244032','403309568','403375104','403440640','403506176','403571712','403637248','403702784','403768320','403833856','403899392','403964928','404030464','404096000','404161536','404227072','404292608','404358144','404423680','404489216','404554752','404620288','404685824','404751360','404816896','404882432','404947968','405013504','405079040','405144576','405210112','405275648','405341184','405406720','405472256','405537792','405603328','405668864','405734400','405799936','405865472','405931008','405996544','406062080','406127616','406193152','406258688','406324224','406389760','406455296','406520832','406586368','406651904','406717440','406782976','406848512');
    --
    Ln_Total := Lr_ListSpid2.count;
    FOR i in 1 .. Ln_Total LOOP
        --
        Ln_IdDetallePar := NULL;
        OPEN C_GetIdDetParametro(i);
        FETCH C_GetIdDetParametro INTO Ln_IdDetallePar, Lv_Spid;
        CLOSE C_GetIdDetParametro;
        --
        IF Ln_IdDetallePar IS NOT NULL THEN
            UPDATE DB_GENERAL.ADMI_PARAMETRO_DET
            SET VALOR3 = Lr_ListSpid2(i)
                , VALOR4 = Lr_ListSpid3(i)
                , VALOR5 = Lr_ListSpid4(i)
                , USR_ULT_MOD = Lv_User
                , FE_ULT_MOD = SYSDATE
                , IP_ULT_MOD = Lv_Ip
            WHERE ID_PARAMETRO_DET = Ln_IdDetallePar;
        END IF;
        --
    END LOOP;
    --
    COMMIT;
    --
    EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
END;
/
