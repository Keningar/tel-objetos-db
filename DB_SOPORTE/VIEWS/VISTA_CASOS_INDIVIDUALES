CREATE OR REPLACE OR REPLACE VIEW "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" ("ID_CASO", "NUMERO_CASO", "FE_APERTURA", "TIPO_AFECTADO", "PUNTO_ID", "LOGIN", "DETALLE_ID") AS 
  SELECT    
    ca.ID_CASO,
    ca.NUMERO_CASO,
    ca.FE_APERTURA,
    af.TIPO_AFECTADO,
    af.AFECTADO_ID,   
    af.AFECTADO_NOMBRE,  
    af.detalle_id    
FROM
    DB_SOPORTE.INFO_PARTE_AFECTADA af,
    DB_SOPORTE.INFO_DETALLE de,
    DB_SOPORTE.INFO_CASO ca,
    DB_SOPORTE.INFO_DETALLE_HIPOTESIS dh,
 (
SELECT
        MIN (c.ID_DETALLE) ID_DETALLE, 
        COUNT(*) as AFECTADOS
        FROM
            DB_SOPORTE.INFO_CASO A,
            DB_SOPORTE.INFO_DETALLE_HIPOTESIS b,
            DB_SOPORTE.INFO_DETALLE c ,
            INFO_PARTE_AFECTADA D
        WHERE
            A .id_caso = b.CASO_ID
        AND b.ID_DETALLE_HIPOTESIS = c.DETALLE_HIPOTESIS_ID
        AND C.ID_DETALLE = D.DETALLE_ID
        GROUP BY
            D.DETALLE_ID,
            A .ID_CASO)  X

WHERE
    af.DETALLE_ID =X.ID_DETALLE
AND X.AFECTADOS = 1 --Toma solo los casos que tengan una sola afectacion
AND af.TIPO_AFECTADO = 'Cliente' --Casos con una sola afectacion y sean solo Clientes
AND af.DETALLE_ID = de.ID_DETALLE
AND de.DETALLE_HIPOTESIS_ID = dh.ID_DETALLE_HIPOTESIS
AND dh.CASO_ID = ca.ID_CASO;
-- new object type path: SCHEMA_EXPORT/VIEW/GRANT/OWNER_GRANT/OBJECT_GRANT
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "TELCOS_CONSULTAS";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "TELCOS_SEL_EXT";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "DBSIT";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "TELCOS_CONSULTAS_TMP";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "TELCOS_ROLE_CONSULTAS";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "TELCOS_SOPORTE_SEL";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "RMORANC";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "DB_SOPORTE_SEL";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "RJBONILLA";
GRANT SELECT ON "DB_SOPORTE"."VISTA_CASOS_INDIVIDUALES" TO "SJAIME";